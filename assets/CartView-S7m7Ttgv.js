import{_ as V,r as g,o as i,c as r,a as t,F as w,f as x,t as f,g as y,d as k,b as n,w as v,n as T,e as L,h as D,i as _}from"./index-3Ds7k2Tn.js";var E={VITE_URL:"https://ec-course-api.hexschool.io",VITE_PATH:"owen-hexschool",BASE_URL:"/vue-hex-week6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:c,VITE_PATH:u}=E,U={data(){return{carts:[],status:{addToCartLoading:"",delCartLoading:""},form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{addToCart(o,e=1){const m={product_id:o.id,qty:e};this.status.addToCartLoading=o.id,this.$http.post(`${c}/api/${u}/cart`,{data:m}).then(()=>{this.status.addToCartLoading="",this.$refs.pModal.close(),this.getCarts()}).catch(p=>{alert("未加入購物車",p.response)})},getCarts(){this.$http(`${c}/api/${u}/cart`).then(o=>{this.carts=o.data.data}).catch(o=>{alert("未取得購物車資料",o.response)})},changeQty(o,e=1){const m={product_id:o.product_id,qty:e};this.$http.put(`${c}/api/${u}/cart/${o.id}`,{data:m}).then(()=>{this.getCarts()}).catch(p=>{alert("未變更購物車數量",p.response)})},delCart(o){this.$http.delete(`${c}/api/${u}/cart/${o}`).then(e=>{alert("已刪除單一購物車品項",e.data.message),this.getCarts()}).catch(e=>{alert("未刪除單一購物車品項",e.response)})},delCarts(){this.status.delCartLoading=this.carts,this.$http.delete(`${c}/api/${u}/carts`).then(o=>{this.status.delCartLoading="",alert(o.data.message),this.getCarts()}).catch(o=>{this.status.delCartLoading="",alert(o.response)})},isPhone(o){return/^(09)[0-9]{8}$/.test(o)?!0:"電話號碼需09開頭唷"},resetData(){this.$refs.form.resetForm()},onSubmit(){const o=this.form;this.$http.post(`${c}/api/${u}/order`,{data:o}).then(e=>{alert(e.data.message),this.$refs.form.resetForm(),this.getCarts()}).catch(e=>{alert(e.response)})}},mounted(){this.getCarts()}},q={class:"py-5"},N={class:"card py-5 px-3"},S={class:"card-body"},F={class:"row justify-content-center"},$={class:"col-md-10"},A={class:"table align-middle text-center"},M=t("thead",null,[t("tr",null,[t("th",{width:"150"},"商品圖"),t("th",{width:"200"},"品名"),t("th",null,"數量"),t("th",{width:"150"},"單價")])],-1),P={class:"d-flex flex-nowrap justify-content-center"},R=["onClick"],B=t("i",{class:"bi bi-dash-lg"},null,-1),j=[B],z=["onClick"],Q=t("i",{class:"bi bi-trash-fill"},null,-1),H=[Q],O=["onUpdate:modelValue"],G=["onClick"],J=t("i",{class:"bi bi-plus-lg"},null,-1),K=[J],W={class:"text-end"},X={class:"text-end fw-bold"},Y=t("td",{colspan:"3"},"總價",-1),Z={colspan:"4"},I={key:0,class:"text-success text-end fw-bold"},tt=t("td",{colspan:"3"},"優惠價",-1),et={colspan:"4"},st={key:0,class:"spinner-border spinner-border-sm","aria-hidden":"true"},ot=t("div",{class:"my-5"},[t("hr")],-1),at={class:"mx-auto",style:{width:"500px"}},lt=t("h3",{class:"fw-bold text-center"}," 請填寫表單 ",-1),nt={class:"mb-3"},dt=t("label",{for:"mail",class:"form-label fw-bold"}," 信箱 ",-1),it={class:"mb-3"},rt=t("label",{for:"name",class:"form-label fw-bold"}," 姓名 ",-1),ct={class:"mb-3"},ut=t("label",{for:"tel",class:"form-label fw-bold"}," 電話 ",-1),ht={class:"mb-3"},_t=t("label",{for:"address",class:"form-label fw-bold"}," 地址 ",-1),mt=t("option",{value:"",selected:"",disabled:""},"請選擇地區",-1),pt=t("option",{value:"台北市"},"台北市",-1),bt=t("option",{value:"新北市"},"新北市",-1),ft=t("option",{value:"桃園市"},"桃園市",-1),gt=t("option",{value:"新竹市"},"新竹市",-1),yt=t("option",{value:"台中市"},"台中市",-1),vt={class:"mb-3"},Ct=t("label",{for:"message",class:"form-label fw-bold"}," 留言 ",-1),Vt={class:"mb-3"},wt={class:"d-flex gap-2 justify-content-end"},xt=t("button",{class:"btn btn-primary w-25",type:"submit"},"送出",-1);function kt(o,e,m,p,a,d){const h=g("VField"),b=g("error-message"),C=g("VForm");return i(),r("div",q,[t("div",N,[t("div",S,[t("div",F,[t("div",$,[t("table",A,[M,t("tbody",null,[(i(!0),r(w,null,x(a.carts.carts,s=>(i(),r("tr",{key:s.id},[t("td",null,[t("div",{style:T([{height:"150px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${s.product.imageUrl})`}])},null,4)]),t("td",null,f(s.product.title),1),t("td",null,[t("div",P,[s.qty>1?(i(),r("button",{key:0,class:"btn btn-outline-primary shadow-none",type:"button",onClick:l=>{s.qty--,d.changeQty(s,s.qty)}},j,8,R)):(i(),r("button",{key:1,class:"btn btn-outline-danger shadow-none",type:"button",onClick:l=>d.delCart(s.id)},H,8,z)),L(t("input",{type:"number",class:"form-control bg-transparent shadow-none text-center",readonly:"","onUpdate:modelValue":l=>s.qty=l},null,8,O),[[D,s.qty]]),t("button",{class:"btn btn-outline-primary shadow-none",type:"button",onClick:l=>{s.qty++,d.changeQty(s,s.qty)}},K,8,G)])]),t("td",W," $"+f(s.total),1)]))),128))]),t("tfoot",null,[t("tr",X,[Y,t("td",Z,f(a.carts.total)+"元",1)]),a.carts.final_total!==a.carts.total?(i(),r("tr",I,[tt,t("td",et,f(a.carts.final_total)+"元",1)])):y("",!0)])]),t("button",{class:"btn btn-outline-danger d-block ms-auto",type:"button",onClick:e[0]||(e[0]=(...s)=>d.delCarts&&d.delCarts(...s))},[a.carts===a.status.delCartLoading?(i(),r("span",st)):y("",!0),k(" 刪除全品項")])])]),ot,t("div",at,[lt,n(C,{action:"#",onSubmit:d.onSubmit,ref:"form"},{default:v(({errors:s})=>[t("div",nt,[dt,n(h,{id:"mail",type:"mail",name:"Email",class:_(["form-control",{"is-invalid":s.Email}]),placeholder:"請輸入信箱",rules:"email|required",modelValue:a.form.user.email,"onUpdate:modelValue":e[1]||(e[1]=l=>a.form.user.email=l)},null,8,["modelValue","class"]),n(b,{name:"Email",class:"invalid-feedback"})]),t("div",it,[rt,n(h,{id:"name",type:"text",name:"Name",class:_(["form-control",{"is-invalid":s.Name}]),rules:"required",modelValue:a.form.user.name,"onUpdate:modelValue":e[2]||(e[2]=l=>a.form.user.name=l),placeholder:"請輸入姓名"},null,8,["modelValue","class"]),n(b,{name:"Name",class:"invalid-feedback"})]),t("div",ct,[ut,n(h,{id:"tel",type:"tel",name:"Telephone",class:_(["form-control",{"is-invalid":s.Telephone}]),rules:d.isPhone,modelValue:a.form.user.tel,"onUpdate:modelValue":e[3]||(e[3]=l=>a.form.user.tel=l),placeholder:"請輸入電話"},null,8,["rules","modelValue","class"]),n(b,{name:"Telephone",class:"invalid-feedback"})]),t("div",ht,[_t,n(h,{id:"address",name:"Area",class:_(["form-control",{"is-invalid":s.Area}]),placeholder:"請輸入地區",rules:"required",modelValue:a.form.user.address,"onUpdate:modelValue":e[4]||(e[4]=l=>a.form.user.address=l),as:"select"},{default:v(()=>[mt,pt,bt,ft,gt,yt]),_:2},1032,["class","modelValue"]),n(b,{name:"Area",class:"invalid-feedback"})]),t("div",vt,[Ct,n(h,{id:"message",rows:"10",name:"Message",class:_(["form-control",{"is-invalid":s.Message}]),modelValue:a.form.user.message,"onUpdate:modelValue":e[5]||(e[5]=l=>a.form.user.message=l),as:"textarea"},null,8,["modelValue","class"])]),t("div",Vt,[t("div",wt,[t("button",{class:"btn btn-outline-secondary w-25",type:"button",onClick:e[6]||(e[6]=(...l)=>d.resetData&&d.resetData(...l))},"取消"),xt])])]),_:1},8,["onSubmit"])])])])])}const Lt=V(U,[["render",kt]]);export{Lt as default};
